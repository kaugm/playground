version: 1

deploy:
  steps:
    setupVariables:
      after:
        - pip3 install checkov
    terraformPlan:
      after:
        - terraform plan --out tfplan.binary
        - terraform show -json tfplan.binary | jq > tfplan.json
        - cat tfplan.json
        - print $ENV0_TF_PLAN_JSON
        - checkov -f tfplan.json --external-checks-dir extra_checkov_checks --check CKV_AWS_999
